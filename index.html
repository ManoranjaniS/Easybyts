<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MK Trading Platform</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        /* Full window height */
        html, body {
            margin: 0;
            padding: 0;
            height: 100%;
            font-family: Arial, sans-serif;
            background-color: #f4f4f9;
        }

        header {
            background-color: #333;
            color: white;
            text-align: left;
            padding: 20px;
            position: fixed;
            top: 0;
            width: 100%;
            z-index: 10;
            font-size: 1.5em;
            font-weight: bold;
            display: flex;
            align-items: center;
        }

        header h1 {
            margin: 0;
        }

        .container {
            display: flex;
            justify-content: space-between;
            flex-direction: column;
            height: 100%;
            padding-top: 80px; /* Allow space for header */
            box-sizing: border-box;
        }

        .panel {
            width: 100%;
            padding: 20px;
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            margin: 10px;
            overflow-y: auto;
            flex-grow: 1;
        }

        .panel h2, .panel h3 {
            margin-top: 0;
        }

        .btn {
            padding: 10px 20px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin: 10px 0;
        }

        .btn:hover {
            background-color: #0056b3;
        }

        .form-input {
            width: 100%;
            padding: 10px;
            margin: 5px 0;
            border-radius: 4px;
            border: 1px solid #ccc;
        }

        .form-error {
            color: red;
        }

        .form-success {
            color: green;
        }

        .stock-item {
            padding: 10px;
            margin: 10px;
            background-color: #f9f9f9;
            border-radius: 8px;
            box-shadow: 0 0 5px rgba(0, 0, 0, 0.1);
        }

        .stock-actions {
            margin-top: 10px;
        }

        .stock-pair {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
        }

        .growth-chart {
            width: 100%;
            height: 400px;
        }

        /* Adjust for large screens */
        @media (min-width: 768px) {
            .container {
                flex-direction: row;
            }

            .left-panel, .right-panel {
                flex-grow: 1;
                margin: 10px;
            }

            .right-panel {
                display: flex;
                flex-direction: column;
                gap: 20px;
            }
        }

        .insufficient-funds {
            color: red;
            font-weight: bold;
        }

        .left-panel, .right-panel {
            flex-grow: 1;
        }

        .right-panel {
            margin-top: 20px;
        }

        .transaction-history-table {
            width: 100%;
            border-collapse: collapse;
        }

        .transaction-history-table th, .transaction-history-table td {
            padding: 8px 15px;
            border: 1px solid #ddd;
        }

        .transaction-history-table th {
            background-color: #f4f4f9;
        }

    </style>
</head>

<body>
    <header>
        <h1>MK Trading Platform</h1>
    </header>

    <div class="container" id="app-container">
        <!-- Registration Section -->
        <div id="registration-panel" class="panel">
            <h2>Register</h2>
            <form id="registration-form">
                <div>
                    <label for="username">Username:</label>
                    <input type="text" id="username" class="form-input" required>
                </div>
                <div>
                    <label for="password">Password (8 characters max):</label>
                    <input type="password" id="password" class="form-input" required>
                </div>
                <div>
                    <input type="checkbox" id="captcha" required>
                    <label for="captcha">I'm not a robot</label>
                </div>
                <div>
                    <button type="submit" class="btn">Register</button>
                </div>
                <div id="registration-error" class="form-error"></div>
            </form>
        </div>

        <!-- Main Content (Stock Trading) - Hidden initially -->
        <div id="main-content-panel" class="panel" style="display: none;">
            <div class="left-panel">
                <div id="dashboard"></div>
                <div id="stock-list"></div>
            </div>

            <div class="right-panel">
                <h3>My Growth</h3>
                <canvas id="growth-chart" class="growth-chart"></canvas>
                <h3>Transaction History</h3>
                <table class="transaction-history-table">
                    <thead>
                        <tr>
                            <th>Symbol</th>
                            <th>Action</th>
                            <th>Quantity</th>
                            <th>Price</th>
                            <th>Total</th>
                        </tr>
                    </thead>
                    <tbody id="transaction-history"></tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        let user = {
            username: '',
            password: '',
            balance: 10000 // Starting balance
        };

        const stocks = [
            { symbol: "AAPL", name: "Apple Inc.", price: 145.09 },
            { symbol: "AMZN", name: "Amazon", price: 3341.95 },
            { symbol: "GOOG", name: "Google", price: 2750.56 },
            { symbol: "MSFT", name: "Microsoft", price: 299.35 },
            { symbol: "TSLA", name: "Tesla", price: 774.46 },
            { symbol: "META", name: "Meta", price: 345.65 },
            { symbol: "NFLX", name: "Netflix", price: 456.78 },
            { symbol: "NVDA", name: "NVIDIA", price: 860.12 },
            { symbol: "AMD", name: "AMD", price: 121.45 },
            { symbol: "BA", name: "Boeing", price: 227.35 }
        ];

        let portfolio = {};
        let transactionHistory = [];
        let growthData = [];
        let timestamps = [];
        let growthChart;

        // Handle registration
        document.getElementById("registration-form").addEventListener("submit", function (event) {
            event.preventDefault();
            const username = document.getElementById("username").value.trim();
            const password = document.getElementById("password").value.trim();
            const captcha = document.getElementById("captcha").checked;

            // Validate username and password
            if (username === '' || password === '') {
                document.getElementById("registration-error").textContent = 'Username and password are required.';
                return;
            }
            if (password.length > 8) {
                document.getElementById("registration-error").textContent = 'Password must be 8 characters or less.';
                return;
            }
            if (!captcha) {
                document.getElementById("registration-error").textContent = 'You must confirm you are not a robot.';
                return;
            }

            // Successful registration
            user.username = username;
            user.password = password;
            document.getElementById("registration-panel").style.display = 'none';
            document.getElementById("main-content-panel").style.display = 'flex';
            showDashboard();
            displayStocks();
        });

        // Show dashboard with portfolio and transaction history
        function showDashboard() {
            const dashboard = document.getElementById("dashboard");
            dashboard.innerHTML = ` 
                <h2>Welcome, ${user.username}!</h2>
                <p>Your current balance: $${user.balance.toFixed(2)}</p>
                <h3>Your Portfolio</h3>
                <table>
                    <thead>
                        <tr>
                            <th>Symbol</th>
                            <th>Shares</th>
                            <th>Average Price</th>
                            <th>Value</th>
                        </tr>
                    </thead>
                    <tbody id="portfolio-table-body"></tbody>
                </table>
                ${user.balance <= 0 ? '<p class="insufficient-funds">Insufficient funds to make any transactions.</p>' : ''}
            `;
        }

        // Display stocks in 5 pairs
        function displayStocks() {
            const stockList = document.getElementById("stock-list");
            stockList.innerHTML = '';
            for (let i = 0; i < stocks.length; i += 2) {
                const stockPair = document.createElement('div');
                stockPair.classList.add('stock-pair');
                stockPair.innerHTML = `
                    <div class="stock-item">
                        <div class="stock-name">${stocks[i].name} (${stocks[i].symbol})</div>
                        <div class="stock-price">$${stocks[i].price.toFixed(2)}</div>
                        <div class="stock-actions">
                            <button class="btn" onclick="buyStock('${stocks[i].symbol}', ${stocks[i].price})">Buy</button>
                            <button class="btn" onclick="sellStock('${stocks[i].symbol}', ${stocks[i].price})">Sell</button>
                        </div>
                    </div>
                    <div class="stock-item">
                        <div class="stock-name">${stocks[i + 1].name} (${stocks[i + 1].symbol})</div>
                        <div class="stock-price">$${stocks[i + 1].price.toFixed(2)}</div>
                        <div class="stock-actions">
                            <button class="btn" onclick="buyStock('${stocks[i + 1].symbol}', ${stocks[i + 1].price})">Buy</button>
                            <button class="btn" onclick="sellStock('${stocks[i + 1].symbol}', ${stocks[i + 1].price})">Sell</button>
                        </div>
                    </div>
                `;
                stockList.appendChild(stockPair);
            }
        }

        // Handle stock buying
        function buyStock(symbol, price) {
            const quantity = prompt(`How many shares of ${symbol} do you want to buy?`);
            if (quantity && !isNaN(quantity) && quantity > 0) {
                const totalCost = price * quantity;
                if (user.balance >= totalCost) {
                    // Update balance and portfolio
                    user.balance -= totalCost;
                    if (!portfolio[symbol]) {
                        portfolio[symbol] = { price, quantity: 0 };
                    }
                    portfolio[symbol].quantity += parseInt(quantity);
                    addTransaction(symbol, 'Buy', quantity, price);
                    showDashboard();
                    updateGrowthChart();
                } else {
                    alert('Insufficient funds to make this purchase.');
                }
            }
        }

        // Handle stock selling
        function sellStock(symbol, price) {
            const quantity = prompt(`How many shares of ${symbol} do you want to sell?`);
            if (quantity && !isNaN(quantity) && quantity > 0 && portfolio[symbol] && portfolio[symbol].quantity >= quantity) {
                const totalSale = price * quantity;
                user.balance += totalSale;
                portfolio[symbol].quantity -= parseInt(quantity);
                if (portfolio[symbol].quantity === 0) {
                    delete portfolio[symbol];
                }
                addTransaction(symbol, 'Sell', quantity, price);
                showDashboard();
                updateGrowthChart();
            } else {
                alert('You do not have enough shares to sell.');
            }
        }

        // Record transaction
        function addTransaction(symbol, action, quantity, price) {
            const total = price * quantity;
            transactionHistory.push({ symbol, action, quantity, price, total });
            displayTransactionHistory();
        }

        // Display transaction history
        function displayTransactionHistory() {
            const history = document.getElementById("transaction-history");
            history.innerHTML = '';
            transactionHistory.forEach(transaction => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${transaction.symbol}</td>
                    <td>${transaction.action}</td>
                    <td>${transaction.quantity}</td>
                    <td>$${transaction.price.toFixed(2)}</td>
                    <td>$${transaction.total.toFixed(2)}</td>
                `;
                history.appendChild(row);
            });
        }
// Update growth chart with portfolio value (balance + stocks)
function updateGrowthChart() {
    // Calculate the total value of the portfolio
    const totalPortfolioValue = Object.keys(portfolio).reduce((total, symbol) => {
        const stock = stocks.find(stock => stock.symbol === symbol);
        return total + (stock.price * portfolio[symbol].quantity);
    }, 0) + user.balance;

    // Add the current time and portfolio value to the chart data
    timestamps.push(new Date().toLocaleTimeString());
    growthData.push(totalPortfolioValue);

    // Update the chart with the new data
    if (growthChart) {
        growthChart.update();
    } else {
        const ctx = document.getElementById('growth-chart').getContext('2d');
        growthChart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: timestamps,
                datasets: [{
                    label: 'Portfolio Growth',
                    data: growthData,
                    fill: false,
                    borderColor: 'rgb(75, 192, 192)',  // line color
                    tension: 0.1
                }]
            },
            options: {
                responsive: true,
                scales: {
                    x: {
                        type: 'linear',
                        position: 'bottom'
                    },
                    y: {
                        ticks: {
                            callback: function (value) {
                                return '$' + value.toFixed(2);  // Format the y-axis as currency
                            }
                        }
                    }
                }
            }
        });
    }
}
// Inside the buyStock and sellStock functions, after a transaction is completed:
updateGrowthChart();

        // Update growth chart
        function updateGrowthChart() {
            const totalPortfolioValue = Object.keys(portfolio).reduce((total, symbol) => {
                const stock = stocks.find(stock => stock.symbol === symbol);
                return total + (stock.price * portfolio[symbol].quantity);
            }, 0) + user.balance;

            timestamps.push(new Date().toLocaleTimeString());
            growthData.push(totalPortfolioValue);

            if (growthChart) {
                growthChart.update();
            } else {
                const ctx = document.getElementById('growth-chart').getContext('2d');
                growthChart = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: timestamps,
                        datasets: [{
                            label: 'Portfolio Growth',
                            data: growthData,
                            fill: false,
                            borderColor: 'rgb(75, 192, 192)',
                            tension: 0.1
                        }]
                    },
                    options: {
                        responsive: true,
                        scales: {
                            x: {
                                type: 'linear',
                                position: 'bottom'
                            }
                        }
                    }
                });
            }
        }

    </script>
</body>

</html>
